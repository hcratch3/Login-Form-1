<!DOCTYPE html>
<html>
<head>
    <title>QRコード表示</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js" integrity="sha512-CNgIRecGo7nphbeZ04Sc13ka07paqdeTu0WR1IM4kNcpmBAUSHSQX0FslNhTDadL4O5SAGapGt4FodqL8My0mA==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>  

</head>
<body>
    <h1>QRコード</h1>
    <div id="qrcode"></div>

    <script>
    // ページが読み込まれた時にクッキーを設定し、5分後にログアウトする
    window.onload = function() {
            
        // URLパラメーターからユーザー名を取得
        var urlParams = new URLSearchParams(window.location.search);
        var username = urlParams.get('username');

        // ユーザー名を使用してQRコードを生成
        generateQRCode(username);
        setTimeout(function() {
                var lastAccess = getCookie("lastAccess");
                if (lastAccess !== null) {
                    var now = new Date().getTime();
                    var elapsedTime = now - parseInt(lastAccess);
                    if (elapsedTime > 5 * 60 * 1000) { // 5分経過したらログアウト
                        alert("セッションがタイムアウトしました。ログイン画面に戻ります。");
                        window.location.href = "login.html"; // ログイン画面にリダイレクト
                    }
                }
            }, 5 * 60 * 1000);
        // QRコードを生成する関数
        var qrcode = new QRCode('QR', {
          text:  username.value,
          width: 128,
          height: 128,
          correctLevel : QRCode.CorrectLevel.H
        });  
        // クッキーの値を取得する関数
        function getCookie(name) {
            var cookies = document.cookie.split(';');
            for(var i = 0; i < cookies.length; i++) {
                var cookie = cookies[i].trim();
                if (cookie.indexOf(name) === 0) {
                    return cookie.substring(name.length + 1);
                }
            }
            return null;
        }
    };
    </script>
</body>
</html>
